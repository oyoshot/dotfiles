#!/usr/bin/env sh
set -euf

if grep -qiE "(Microsoft|WSL)" /proc/version 2>/dev/null; then
  if command -v win32yank.exe >/dev/null 2>&1; then
    exec win32yank.exe -i --crlf
  fi
fi

self_path="$(command -v pbcopy 2>/dev/null || true)"
self_dir=""
if [ -n "$self_path" ]; then
  self_dir="$(dirname "$self_path")"
fi

new_path=""
IFS=:
for p in $PATH; do
  if [ -n "$self_dir" ] && [ "$p" = "$self_dir" ]; then
    continue
  fi
  if [ -z "$new_path" ]; then
    new_path="$p"
  else
    new_path="$new_path:$p"
  fi
done
unset IFS

if [ -n "$new_path" ]; then
  if pbcopy_path="$(PATH="$new_path" command -v pbcopy 2>/dev/null)"; then
    exec "$pbcopy_path" "$@"
  fi
fi

if command -v wl-copy >/dev/null 2>&1; then
  exec wl-copy "$@"
fi

if command -v xsel >/dev/null 2>&1; then
  exec xsel --input --clipboard "$@"
fi

if command -v xclip >/dev/null 2>&1; then
  exec xclip -i -selection clipboard "$@"
fi

echo "pbcopy: no clipboard utility found" >&2
exit 127
